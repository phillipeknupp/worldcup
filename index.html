<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interativo - Copa 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #1a252f;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--radius);
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 6px solid var(--accent);
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        h1 i {
            color: var(--accent);
        }
        
        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-3px);
        }
        
        .btn-primary:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: #27ae60;
            transform: translateY(-3px);
        }
        
        .btn-success:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            background: #e67e22;
            transform: translateY(-3px);
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-3px);
        }
        
        /* SE√á√ÉO DE GRUPOS - NO TOPO */
        .section-grupos {
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
        }
        
        .section-grupos h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 15px;
        }
        
        .group-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-top: 5px solid var(--secondary);
        }
        
        .group-card h3 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.5rem;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }
        
        .team-list {
            list-style: none;
            min-height: 280px;
        }
        
        .team-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: move;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
            user-select: none;
        }
        
        .team-item:active {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .team-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .team-item.primeiro {
            border-left-color: #2ecc71;
            background: #f0fff4;
        }
        
        .team-item.segundo {
            border-left-color: #3498db;
            background: #f0f8ff;
        }
        
        .team-item.terceiro {
            border-left-color: #f39c12;
            background: #fffaf0;
        }
        
        .team-item.quarto {
            border-left-color: #95a5a6;
            background: #f8f9fa;
        }
        
        .team-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .team-pos {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .team-flag {
            font-size: 1.5rem;
        }
        
        .team-name {
            flex-grow: 1;
            font-weight: 500;
        }
        
        .instructions {
            background: #fff8e1;
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 25px;
            border-left: 4px solid #ffc107;
        }
        
        .instructions h3 {
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        /* SE√á√ÉO DE MATA-MATA - ABAIXO DOS GRUPOS */
        .section-mata-mata {
            background: rgba(255, 255, 255, 0.97);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        
        .section-mata-mata h2 {
            color: var(--primary);
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* CONTROLES DO MATA-MATA */
        .mata-mata-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .phase-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .phase-control .btn {
            min-width: 200px;
        }
        
        /* CHAVEAMENTO ESPELHADO */
        .bracket-container {
            position: relative;
            min-height: 800px;
            overflow-x: auto;
            padding: 20px 0;
        }
        
        .bracket {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            min-width: 1400px;
        }
        
        /* COLUNAS DO CHAVEAMENTO */
        .round-column {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: 750px;
            width: 22%;
        }
        
        .round-column.left {
            align-items: flex-start;
        }
        
        .round-column.right {
            align-items: flex-end;
        }
        
        .round-column.center {
            width: 32%;
            align-items: center;
        }
        
        .round-title {
            text-align: center;
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 700;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 30px;
            width: 100%;
        }
        
        .match {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid #e9ecef;
            transition: all 0.2s ease;
            width: 280px;
            position: relative;
        }
        
        .match.completed {
            border-color: var(--success);
        }
        
        .match:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
            border-color: var(--secondary);
        }
        
        .team {
            padding: 12px 15px;
            margin: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .team:hover {
            background: #f8f9fa;
            transform: translateX(3px);
        }
        
        .team.winner {
            background: #e8f5e9;
            font-weight: 700;
            color: #2e7d32;
            border-left: 4px solid #2ecc71;
        }
        
        .team .flag {
            font-size: 1.3rem;
            margin-right: 12px;
        }
        
        .final-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 50px;
        }
        
        .final-match {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border: 3px solid var(--accent);
            width: 320px;
            position: relative;
            margin: 20px auto;
        }
        
        .final-match::before {
            content: "üèÜ FINAL";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 6px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
        }
        
        .third-place-match {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border: 2px solid #f39c12;
            width: 280px;
            position: relative;
            margin-top: 40px;
        }
        
        .third-place-match::before {
            content: "ü•â 3¬∫ LUGAR";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #f39c12;
            color: white;
            padding: 4px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 2;
        }
        
        .phase-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-bar {
            flex-grow: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .status-bar {
            background: white;
            border-radius: var(--radius);
            padding: 15px 25px;
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-icon {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        
        .status-icon.active {
            background: var(--success);
            animation: pulse 1.5s infinite;
        }
        
        .status-icon.waiting {
            background: #f39c12;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .drag-info {
            background: var(--primary);
            color: white;
            border-radius: 50px;
            padding: 8px 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        @media (max-width: 1200px) {
            .groups-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .bracket {
                min-width: 1200px;
            }
            
            .round-column {
                width: 24%;
            }
            
            .round-column.center {
                width: 28%;
            }
            
            .match {
                width: 240px;
            }
            
            .final-match {
                width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .groups-container {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .bracket {
                flex-direction: column;
                min-width: 100%;
            }
            
            .round-column {
                width: 100%;
                min-height: auto;
                margin-bottom: 40px;
            }
            
            .round-column.center {
                order: 3;
            }
            
            .match {
                width: 100%;
                max-width: 300px;
                margin: 10px auto;
            }
            
            .mata-mata-controls {
                flex-direction: column;
                align-items: center;
            }
        }
        
        /* Bot√£o de definir campe√£o manualmente */
        .btn-champion {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .btn-champion:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }
        
        .btn-champion:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        
        .modal h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            float: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-futbol"></i> Simulador Interativo - Copa do Mundo 2026</h1>
            <p class="subtitle">Organize os grupos, simule os confrontos e defina o campe√£o</p>
            
            <div class="controls">
                <button class="btn btn-primary" id="btn-montar-chaveamento">
                    <i class="fas fa-sitemap"></i> Montar Chaveamento
                </button>
                <button class="btn btn-success" id="btn-reset-grupos">
                    <i class="fas fa-redo"></i> Redefinir Grupos
                </button>
                <button class="btn btn-danger" id="btn-nova-simulacao">
                    <i class="fas fa-fire"></i> Nova Simula√ß√£o
                </button>
            </div>
        </header>
        
        <!-- SE√á√ÉO DE GRUPOS (PARTE SUPERIOR) -->
        <section class="section-grupos">
            <h2><i class="fas fa-list-ol"></i> Fase de Grupos - Arraste para Definir Classifica√ß√£o</h2>
            <p class="drag-info"><i class="fas fa-arrows-alt"></i> Arraste os times para definir a ordem (1¬∫ a 4¬∫ lugar) em cada grupo</p>
            
            <div class="groups-container" id="grupos-container">
                <!-- Grupos ser√£o gerados aqui -->
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Instru√ß√µes:</h3>
                <ol>
                    <li><strong>Arraste os times</strong> para definir a ordem de classifica√ß√£o em cada grupo</li>
                    <li>Os <strong>dois primeiros</strong> de cada grupo + <strong>8 melhores terceiros</strong> se classificam para a fase final</li>
                    <li>Clique em <strong>"Montar Chaveamento"</strong> para gerar os confrontos da fase mata-mata</li>
                    <li>Selecione todos os vencedores de uma fase antes de avan√ßar para a pr√≥xima usando os bot√µes de controle</li>
                </ol>
            </div>
        </section>
        
        <!-- SE√á√ÉO DE MATA-MATA (PARTE INFERIOR) -->
        <section class="section-mata-mata" id="section-mata-mata" style="display: none;">
            <h2><i class="fas fa-trophy"></i> Fase Mata-Mata - Copa do Mundo 2026</h2>
            
            <!-- CONTROLES DO MATA-MATA -->
            <div class="mata-mata-controls" id="mata-mata-controls">
                <!-- Controles ser√£o inseridos aqui via JavaScript -->
            </div>
            
            <div class="bracket-container">
                <div class="bracket" id="chaveamento-container">
                    <!-- COLUNA ESQUERDA: Rodada de 32 -->
                    <div class="round-column left" id="round-32-left">
                        <div class="round-title">Rodada de 32</div>
                        <!-- Jogos 1-8 ser√£o inseridos aqui -->
                    </div>
                    
                    <!-- COLUNA CENTRO-ESQUERDA: Oitavas de Final -->
                    <div class="round-column left" id="round-16-left">
                        <div class="round-title">Oitavas de Final</div>
                        <!-- Oitavas 1-4 ser√£o inseridas aqui -->
                    </div>
                    
                    <!-- COLUNA CENTRAL: Quartas e Semifinais -->
                    <div class="round-column center" id="round-center">
                        <div class="round-title">Quartas de Final</div>
                        <!-- Quartas ser√£o inseridas aqui -->
                        
                        <div class="round-title" style="margin-top: 40px;">Semifinais</div>
                        <!-- Semifinais ser√£o inseridas aqui -->
                        
                        <div class="final-container">
                            <div class="match final-match" id="final-match">
                                <div class="team" data-team="final-1">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                                <div class="team" data-team="final-2">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                            </div>
                            
                            <button class="btn-champion" id="btn-definir-campeao" style="display: none;">
                                <i class="fas fa-crown"></i> Definir Campe√£o
                            </button>
                            
                            <div class="match third-place-match" id="third-place-match" style="display: none;">
                                <div class="team" data-team="third-1">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                                <div class="team" data-team="third-2">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- COLUNA CENTRO-DIREITA: Oitavas de Final -->
                    <div class="round-column right" id="round-16-right">
                        <div class="round-title">Oitavas de Final</div>
                        <!-- Oitavas 5-8 ser√£o inseridas aqui -->
                    </div>
                    
                    <!-- COLUNA DIREITA: Rodada de 32 -->
                    <div class="round-column right" id="round-32-right">
                        <div class="round-title">Rodada de 32</div>
                        <!-- Jogos 9-16 ser√£o inseridos aqui -->
                    </div>
                </div>
            </div>
            
            <div class="instructions" style="margin-top: 30px;">
                <h3><i class="fas fa-mouse-pointer"></i> Como Interagir com o Chaveamento:</h3>
                <ol>
                    <li>Clique em qualquer time nos confrontos para defini-lo como vencedor</li>
                    <li>Selecione <strong>todos os vencedores</strong> da fase atual</li>
                    <li>Clique no bot√£o <strong>"Avan√ßar para Oitavas"</strong> para gerar os pr√≥ximos confrontos</li>
                    <li>Repita o processo at√© chegar √† final</li>
                    <li>Quando as duas finalistas estiverem definidas, o bot√£o "Definir Campe√£o" aparecer√°</li>
                </ol>
            </div>
        </section>
        
        <div class="status-bar">
            <div class="status">
                <div class="status-icon active" id="status-grupos"></div>
                <span>Fase de Grupos: <strong id="status-text-grupos">Pronta para organizar</strong></span>
            </div>
            <div class="status">
                <div class="status-icon waiting" id="status-mata"></div>
                <span>Fase Mata-Mata: <strong id="status-text-mata">Aguardando chaveamento</strong></span>
            </div>
            <div class="drag-info">
                <i class="fas fa-hand-pointer"></i> Clique nos times para definir os vencedores
            </div>
        </div>
        
        <div class="modal" id="modal-campeao">
            <div class="modal-content">
                <h3><i class="fas fa-trophy"></i> Escolha o Campe√£o da Copa 2026</h3>
                <div id="campeao-content" style="text-align: center; padding: 20px 0;">
                    <!-- Op√ß√µes de campe√£o ser√£o inseridas aqui -->
                </div>
                <button class="close-modal" id="close-modal">Cancelar</button>
            </div>
        </div>
        
        <footer>
            <p>Simulador da Copa do Mundo 2026 | Dados baseados no sorteio oficial de 5 de dezembro de 2025</p>
            <p>As 6 vagas de repescagem s√£o representadas pelas equipes indicadas como "Playoff"</p>
        </footer>
    </div>

    <script>
        // Dados dos grupos (conforme sorteio de 5/dez/2025)
        const gruposData = [
            { letra: 'A', times: ['M√©xico', '√Åfrica do Sul', 'Coreia do Sul', 'Rep√∫blica Tcheca'] },
            { letra: 'B', times: ['Canad√°', 'It√°lia', 'Catar', 'Su√≠√ßa'] },
            { letra: 'C', times: ['Brasil', 'Marrocos', 'Haiti', 'Esc√≥cia'] },
            { letra: 'D', times: ['Estados Unidos', 'Paraguai', 'Austr√°lia', 'Turquia'] },
            { letra: 'E', times: ['Alemanha', 'Cura√ßao', 'Costa do Marfim', 'Equador'] },
            { letra: 'F', times: ['Holanda', 'Jap√£o', 'Ucr√¢nia', 'Tun√≠sia'] },
            { letra: 'G', times: ['B√©lgica', 'Egito', 'Ir√£', 'Nova Zel√¢ndia'] },
            { letra: 'H', times: ['Espanha', 'Cabo Verde', 'Ar√°bia Saudita', 'Uruguai'] },
            { letra: 'I', times: ['Fran√ßa', 'Senegal', 'Bol√≠via', 'Noruega'] },
            { letra: 'J', times: ['Argentina', 'Arg√©lia', '√Åustria', 'Jord√¢nia'] },
            { letra: 'K', times: ['Portugal', 'RD Congo', 'Uzbequist√£o', 'Col√¥mbia'] },
            { letra: 'L', times: ['Inglaterra', 'Cro√°cia', 'Gana', 'Panam√°'] }
        ];

        // Estado da simula√ß√£o
        let classificados = { primeiros: [], segundos: [], terceiros: [] };
        let chaveamento = { 
            r32: [],  // Rodada de 32 (oitavas)
            r16: [],  // Oitavas de final
            qf: [],   // Quartas de final
            sf: [],   // Semifinais
            final: null,
            third: null
        };
        let grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
        let faseAtual = 'r32'; // r32, r16, qf, sf, final
        
        // Bandeiras para os times
        const flags = {
            'Brasil': 'üáßüá∑', 'Argentina': 'üá¶üá∑', 'Fran√ßa': 'üá´üá∑', 'Alemanha': 'üá©üá™',
            'Espanha': 'üá™üá∏', 'Inglaterra': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', 'Portugal': 'üáµüáπ', 'B√©lgica': 'üáßüá™',
            'Holanda': 'üá≥üá±', 'It√°lia': 'üáÆüáπ', 'Cro√°cia': 'üá≠üá∑', 'Uruguai': 'üá∫üáæ',
            'M√©xico': 'üá≤üáΩ', 'Estados Unidos': 'üá∫üá∏', 'Canad√°': 'üá®üá¶', 'Jap√£o': 'üáØüáµ',
            'Coreia do Sul': 'üá∞üá∑', 'Austr√°lia': 'üá¶üá∫', 'Marrocos': 'üá≤üá¶', 'Senegal': 'üá∏üá≥',
            'Egito': 'üá™üá¨', 'Gana': 'üá¨üá≠', 'Catar': 'üá∂üá¶', 'Ar√°bia Saudita': 'üá∏üá¶',
            'Ir√£': 'üáÆüá∑', 'Col√¥mbia': 'üá®üá¥', 'Paraguai': 'üáµüáæ', 'Equador': 'üá™üá®',
            'Su√≠√ßa': 'üá®üá≠', 'Su√©cia': 'üá∏üá™', 'Pol√¥nia': 'üáµüá±', '√Åustria': 'üá¶üáπ',
            'Ucr√¢nia': 'üá∫üá¶', 'Turquia': 'üáπüá∑', 'Rep√∫blica Tcheca': 'üá®üáø', 'Esc√≥cia': 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø',
            'Noruega': 'üá≥üá¥', 'Costa do Marfim': 'üá®üáÆ', 'Tun√≠sia': 'üáπüá≥', 'Arg√©lia': 'üá©üáø',
            'Nig√©ria': 'üá≥üá¨', 'Cabo Verde': 'üá®üáª', 'Haiti': 'üá≠üáπ', 'Panam√°': 'üáµüá¶',
            'Bol√≠via': 'üáßüá¥', 'RD Congo': 'üá®üá©', 'Nova Zel√¢ndia': 'üá≥üáø', 'Jord√¢nia': 'üáØüá¥',
            'Uzbequist√£o': 'üá∫üáø', 'Cura√ßao': 'üá®üáº', '√Åfrica do Sul': 'üáøüá¶'
        };

        // Inicializa a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            renderizarGrupos();
            configurarEventos();
            atualizarStatus();
        });

        // Renderiza os grupos com capacidade de arrastar
        function renderizarGrupos() {
            const container = document.getElementById('grupos-container');
            container.innerHTML = '';
            
            grupoOrdenado.forEach(grupo => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                groupCard.innerHTML = `
                    <h3>Grupo ${grupo.letra}</h3>
                    <ul class="team-list" data-grupo="${grupo.letra}">
                        ${grupo.times.map((time, index) => `
                            <li class="team-item ${index === 0 ? 'primeiro' : index === 1 ? 'segundo' : index === 2 ? 'terceiro' : 'quarto'}" 
                                data-time="${time}" draggable="true">
                                <div class="team-pos">${index + 1}</div>
                                <div class="team-flag">${flags[time] || 'üè¥'}</div>
                                <div class="team-name">${time}</div>
                                <i class="fas fa-arrows-alt-v" style="color: #aaa;"></i>
                            </li>
                        `).join('')}
                    </ul>
                `;
                
                container.appendChild(groupCard);
            });
            
            // Configurar funcionalidade de arrastar e soltar
            configurarDragAndDrop();
        }

        // Configura a funcionalidade de arrastar e soltar
        function configurarDragAndDrop() {
            const lists = document.querySelectorAll('.team-list');
            let draggedItem = null;
            
            lists.forEach(list => {
                // Evento quando come√ßa a arrastar
                list.addEventListener('dragstart', function(e) {
                    draggedItem = e.target;
                    setTimeout(() => {
                        draggedItem.classList.add('dragging');
                    }, 0);
                });
                
                // Evento quando termina de arrastar
                list.addEventListener('dragend', function(e) {
                    setTimeout(() => {
                        if (draggedItem) {
                            draggedItem.classList.remove('dragging');
                            draggedItem = null;
                        }
                        // Atualiza a ordem do grupo
                        const grupoLetra = list.getAttribute('data-grupo');
                        atualizarOrdemGrupo(grupoLetra);
                        atualizarStatus();
                    }, 0);
                });
                
                // Evento quando est√° sobre a lista
                list.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(list, e.clientY);
                    const dragging = document.querySelector('.dragging');
                    
                    if (afterElement == null) {
                        list.appendChild(dragging);
                    } else {
                        list.insertBefore(dragging, afterElement);
                    }
                });
            });
        }

        // Fun√ß√£o auxiliar para determinar onde soltar o elemento
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.team-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Atualiza a ordem dos times no grupo ap√≥s arrastar
        function atualizarOrdemGrupo(grupoLetra) {
            const grupoIndex = grupoOrdenado.findIndex(g => g.letra === grupoLetra);
            const list = document.querySelector(`[data-grupo="${grupoLetra}"]`);
            const times = Array.from(list.children).map(item => item.dataset.time);
            
            grupoOrdenado[grupoIndex].times = times;
            
            // Atualizar classes de posi√ß√£o
            Array.from(list.children).forEach((item, index) => {
                item.className = 'team-item';
                if (index === 0) item.classList.add('primeiro');
                else if (index === 1) item.classList.add('segundo');
                else if (index === 2) item.classList.add('terceiro');
                else item.classList.add('quarto');
                
                // Atualizar n√∫mero da posi√ß√£o
                item.querySelector('.team-pos').textContent = index + 1;
            });
        }

        // Calcula os classificados com base na ordem atual dos grupos
        function calcularClassificados() {
            classificados = { primeiros: [], segundos: [], terceiros: [] };
            const todosTerceiros = [];
            
            grupoOrdenado.forEach(grupo => {
                // Adiciona primeiro e segundo colocados
                classificados.primeiros.push({ grupo: grupo.letra, time: grupo.times[0] });
                classificados.segundos.push({ grupo: grupo.letra, time: grupo.times[1] });
                
                // Adiciona terceiro para poss√≠vel classifica√ß√£o
                todosTerceiros.push({
                    grupo: grupo.letra,
                    time: grupo.times[2],
                    pts: Math.floor(Math.random() * 6) + 1,
                    sg: Math.floor(Math.random() * 5) - 2,
                    gp: Math.floor(Math.random() * 6) + 1
                });
            });
            
            // Ordena terceiros e pega os 8 melhores
            todosTerceiros.sort((a, b) => b.pts - a.pts || b.sg - a.sg || b.gp - a.gp);
            classificados.terceiros = todosTerceiros.slice(0, 8);
            
            return classificados;
        }

        // Monta o chaveamento inicial (sem simular resultados)
        function montarChaveamento() {
            // Primeiro calcula os classificados
            calcularClassificados();
            
            // Define os confrontos da rodada de 32 conforme formato oficial
            const confrontosR32 = [
                { m: 1, a: classificados.segundos.find(s => s.grupo === 'A').time, b: classificados.segundos.find(s => s.grupo === 'B').time },
                { m: 2, a: classificados.primeiros.find(p => p.grupo === 'E').time, b: classificados.terceiros[0].time },
                { m: 3, a: classificados.primeiros.find(p => p.grupo === 'F').time, b: classificados.segundos.find(s => s.grupo === 'C').time },
                { m: 4, a: classificados.primeiros.find(p => p.grupo === 'C').time, b: classificados.segundos.find(s => s.grupo === 'F').time },
                { m: 5, a: classificados.primeiros.find(p => p.grupo === 'I').time, b: classificados.terceiros[1].time },
                { m: 6, a: classificados.segundos.find(s => s.grupo === 'E').time, b: classificados.segundos.find(s => s.grupo === 'I').time },
                { m: 7, a: classificados.primeiros.find(p => p.grupo === 'A').time, b: classificados.terceiros[2].time },
                { m: 8, a: classificados.primeiros.find(p => p.grupo === 'L').time, b: classificados.terceiros[3].time },
                { m: 9, a: classificados.primeiros.find(p => p.grupo === 'D').time, b: classificados.terceiros[4].time },
                { m: 10, a: classificados.primeiros.find(p => p.grupo === 'G').time, b: classificados.terceiros[5].time },
                { m: 11, a: classificados.segundos.find(s => s.grupo === 'K').time, b: classificados.segundos.find(s => s.grupo === 'L').time },
                { m: 12, a: classificados.primeiros.find(p => p.grupo === 'H').time, b: classificados.segundos.find(s => s.grupo === 'J').time },
                { m: 13, a: classificados.primeiros.find(p => p.grupo === 'B').time, b: classificados.terceiros[6].time },
                { m: 14, a: classificados.primeiros.find(p => p.grupo === 'J').time, b: classificados.segundos.find(s => s.grupo === 'H').time },
                { m: 15, a: classificados.primeiros.find(p => p.grupo === 'K').time, b: classificados.terceiros[7].time },
                { m: 16, a: classificados.segundos.find(s => s.grupo === 'D').time, b: classificados.segundos.find(s => s.grupo === 'G').time }
            ];

            // Inicializa os confrontos SEM vencedores
            chaveamento.r32 = confrontosR32.map(conf => ({
                ...conf,
                vencedor: null
            }));

            // Inicializa as outras rodadas vazias
            chaveamento.r16 = [];
            chaveamento.qf = [];
            chaveamento.sf = [];
            chaveamento.final = null;
            chaveamento.third = null;
            
            // Define a fase atual como rodada de 32
            faseAtual = 'r32';

            // Renderiza o chaveamento
            renderizarChaveamentoEspelhado();
            atualizarStatus();
            criarControlesFases();
            
            // Mostra a se√ß√£o de mata-mata
            document.getElementById('section-mata-mata').style.display = 'block';
            
            // Atualiza bot√£o
            document.getElementById('btn-montar-chaveamento').innerHTML = '<i class="fas fa-sync-alt"></i> Remontar Chaveamento';
        }

        // Cria os controles para cada fase
        function criarControlesFases() {
            const controlsContainer = document.getElementById('mata-mata-controls');
            controlsContainer.innerHTML = '';
            
            const fases = [
                { id: 'r32', nome: 'Rodada de 32', btnText: 'Avan√ßar para Oitavas', nextPhase: 'r16' },
                { id: 'r16', nome: 'Oitavas de Final', btnText: 'Avan√ßar para Quartas', nextPhase: 'qf' },
                { id: 'qf', nome: 'Quartas de Final', btnText: 'Avan√ßar para Semifinais', nextPhase: 'sf' },
                { id: 'sf', nome: 'Semifinais', btnText: 'Avan√ßar para Final', nextPhase: 'final' }
            ];
            
            fases.forEach(fase => {
                const phaseControl = document.createElement('div');
                phaseControl.className = 'phase-control';
                phaseControl.id = `control-${fase.id}`;
                
                // Verifica se esta fase est√° ativa
                const isActive = fase.id === faseAtual;
                const isCompleted = chaveamento[fase.id] && 
                                   chaveamento[fase.id].length > 0 && 
                                   chaveamento[fase.id].every(c => c && c.vencedor);
                
                // Cria o bot√£o para avan√ßar
                const btn = document.createElement('button');
                btn.className = `btn ${isActive ? 'btn-primary' : 'btn-success'}`;
                btn.id = `btn-${fase.id}`;
                btn.innerHTML = `<i class="fas fa-arrow-right"></i> ${fase.btnText}`;
                btn.disabled = !isActive || !isCompleted;
                
                // Adiciona evento de clique
                btn.addEventListener('click', () => {
                    avancarParaProximaFase(fase.nextPhase);
                });
                
                // Cria barra de progresso
                const progress = document.createElement('div');
                progress.className = 'phase-progress';
                
                if (chaveamento[fase.id] && chaveamento[fase.id].length > 0) {
                    const vencedores = chaveamento[fase.id].filter(c => c && c.vencedor).length;
                    const total = chaveamento[fase.id].length;
                    const percent = (vencedores / total) * 100;
                    
                    progress.innerHTML = `
                        <span>${vencedores}/${total} selecionados</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percent}%"></div>
                        </div>
                    `;
                } else {
                    progress.innerHTML = '<span>Aguardando...</span>';
                }
                
                phaseControl.appendChild(btn);
                phaseControl.appendChild(progress);
                controlsContainer.appendChild(phaseControl);
            });
        }

        // Avan√ßa para a pr√≥xima fase
        function avancarParaProximaFase(proximaFase) {
            // Verifica se todos os vencedores da fase atual foram definidos
            const faseAtualDados = chaveamento[faseAtual];
            if (!faseAtualDados || faseAtualDados.length === 0 || !faseAtualDados.every(c => c && c.vencedor)) {
                alert(`Por favor, selecione todos os vencedores da ${getNomeFase(faseAtual)} antes de avan√ßar.`);
                return;
            }
            
            // Gera os confrontos da pr√≥xima fase
            if (proximaFase === 'r16') {
                gerarOitavasDeFinal();
            } else if (proximaFase === 'qf') {
                gerarQuartasDeFinal();
            } else if (proximaFase === 'sf') {
                gerarSemifinais();
            } else if (proximaFase === 'final') {
                gerarFinal();
            }
            
            // Atualiza a fase atual
            faseAtual = proximaFase;
            
            // Re-renderiza o chaveamento
            renderizarChaveamentoEspelhado();
            criarControlesFases();
            atualizarStatus();
        }

        // Gera os confrontos das oitavas de final
        function gerarOitavasDeFinal() {
            chaveamento.r16 = [];
            
            // Cada par de jogos da rodada de 32 gera um jogo das oitavas
            for (let i = 0; i < chaveamento.r32.length; i += 2) {
                const jogo1 = chaveamento.r32[i];
                const jogo2 = chaveamento.r32[i + 1];
                
                if (jogo1 && jogo2 && jogo1.vencedor && jogo2.vencedor) {
                    chaveamento.r16.push({
                        m: chaveamento.r16.length + 1,
                        a: jogo1.vencedor,
                        b: jogo2.vencedor,
                        vencedor: null
                    });
                }
            }
        }

        // Gera os confrontos das quartas de final
        function gerarQuartasDeFinal() {
            chaveamento.qf = [];
            
            // Cada par de jogos das oitavas gera um jogo das quartas
            for (let i = 0; i < chaveamento.r16.length; i += 2) {
                const jogo1 = chaveamento.r16[i];
                const jogo2 = chaveamento.r16[i + 1];
                
                if (jogo1 && jogo2 && jogo1.vencedor && jogo2.vencedor) {
                    chaveamento.qf.push({
                        m: chaveamento.qf.length + 1,
                        a: jogo1.vencedor,
                        b: jogo2.vencedor,
                        vencedor: null
                    });
                }
            }
        }

        // Gera os confrontos das semifinais
        function gerarSemifinais() {
            chaveamento.sf = [];
            
            // Cada par de jogos das quartas gera um jogo das semifinais
            for (let i = 0; i < chaveamento.qf.length; i += 2) {
                const jogo1 = chaveamento.qf[i];
                const jogo2 = chaveamento.qf[i + 1];
                
                if (jogo1 && jogo2 && jogo1.vencedor && jogo2.vencedor) {
                    chaveamento.sf.push({
                        m: chaveamento.sf.length + 1,
                        a: jogo1.vencedor,
                        b: jogo2.vencedor,
                        vencedor: null
                    });
                }
            }
        }

        // Gera a final e disputa pelo 3¬∫ lugar
        function gerarFinal() {
            if (chaveamento.sf.length === 2 && chaveamento.sf[0].vencedor && chaveamento.sf[1].vencedor) {
                // Final
                chaveamento.final = {
                    a: chaveamento.sf[0].vencedor,
                    b: chaveamento.sf[1].vencedor,
                    vencedor: null
                };
                
                // Disputa pelo 3¬∫ lugar
                const perdedor1 = chaveamento.sf[0].a === chaveamento.sf[0].vencedor ? 
                                 chaveamento.sf[0].b : chaveamento.sf[0].a;
                const perdedor2 = chaveamento.sf[1].a === chaveamento.sf[1].vencedor ? 
                                 chaveamento.sf[1].b : chaveamento.sf[1].a;
                
                chaveamento.third = {
                    a: perdedor1,
                    b: perdedor2,
                    vencedor: null
                };
            }
        }

        // Retorna o nome da fase
        function getNomeFase(faseId) {
            const fases = {
                'r32': 'Rodada de 32',
                'r16': 'Oitavas de Final',
                'qf': 'Quartas de Final',
                'sf': 'Semifinais',
                'final': 'Final'
            };
            return fases[faseId] || faseId;
        }

        // Renderiza o chaveamento em layout espelhado
        function renderizarChaveamentoEspelhado() {
            // Limpa as colunas
            const columns = ['round-32-left', 'round-16-left', 'round-center', 'round-16-right', 'round-32-right'];
            columns.forEach(col => {
                const element = document.getElementById(col);
                if (element) {
                    element.innerHTML = `<div class="round-title">${getRoundTitle(col)}</div>`;
                }
            });
            
            // Adiciona o container da final e terceiro lugar ao centro
            const centerColumn = document.getElementById('round-center');
            const finalContainer = document.createElement('div');
            finalContainer.className = 'final-container';
            finalContainer.innerHTML = `
                <div class="match final-match" id="final-match">
                    <div class="team" data-team="final-1">
                        <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                    </div>
                    <div class="team" data-team="final-2">
                        <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                    </div>
                </div>
                
                <button class="btn-champion" id="btn-definir-campeao" style="display: none;">
                    <i class="fas fa-crown"></i> Definir Campe√£o
                </button>
                
                <div class="match third-place-match" id="third-place-match" style="display: none;">
                    <div class="team" data-team="third-1">
                        <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                    </div>
                    <div class="team" data-team="third-2">
                        <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                    </div>
                </div>
            `;
            centerColumn.appendChild(finalContainer);
            
            // Adiciona os confrontos da rodada de 32
            const left32Column = document.getElementById('round-32-left');
            const right32Column = document.getElementById('round-32-right');
            
            // Primeira metade dos jogos (1-8) na coluna esquerda
            for (let i = 0; i < 8; i++) {
                if (chaveamento.r32[i]) {
                    const match = criarElementoMatch(chaveamento.r32[i], 'r32', i);
                    left32Column.appendChild(match);
                }
            }
            
            // Segunda metade dos jogos (9-16) na coluna direita
            for (let i = 8; i < 16; i++) {
                if (chaveamento.r32[i]) {
                    const match = criarElementoMatch(chaveamento.r32[i], 'r32', i);
                    right32Column.appendChild(match);
                }
            }
            
            // Adiciona os confrontos das oitavas se existirem
            const left16Column = document.getElementById('round-16-left');
            const right16Column = document.getElementById('round-16-right');
            
            if (chaveamento.r16 && chaveamento.r16.length > 0) {
                // Primeira metade das oitavas (1-4) na coluna esquerda
                for (let i = 0; i < 4; i++) {
                    if (chaveamento.r16[i]) {
                        const match = criarElementoMatch(chaveamento.r16[i], 'r16', i);
                        left16Column.appendChild(match);
                    }
                }
                
                // Segunda metade das oitavas (5-8) na coluna direita
                for (let i = 4; i < 8; i++) {
                    if (chaveamento.r16[i]) {
                        const match = criarElementoMatch(chaveamento.r16[i], 'r16', i);
                        right16Column.appendChild(match);
                    }
                }
            }
            
            // Adiciona os confrontos das quartas e semifinais no centro
            if (chaveamento.qf && chaveamento.qf.length > 0) {
                // Adiciona t√≠tulo das quartas
                const quartasTitle = document.createElement('div');
                quartasTitle.className = 'round-title';
                quartasTitle.textContent = 'Quartas de Final';
                centerColumn.insertBefore(quartasTitle, finalContainer);
                
                // Adiciona os confrontos das quartas
                chaveamento.qf.forEach((confronto, idx) => {
                    if (confronto) {
                        const match = criarElementoMatch(confronto, 'qf', idx);
                        centerColumn.insertBefore(match, finalContainer);
                    }
                });
            }
            
            if (chaveamento.sf && chaveamento.sf.length > 0) {
                // Adiciona t√≠tulo das semifinais
                const semifinaisTitle = document.createElement('div');
                semifinaisTitle.className = 'round-title';
                semifinaisTitle.textContent = 'Semifinais';
                semifinaisTitle.style.marginTop = '40px';
                centerColumn.insertBefore(semifinaisTitle, finalContainer);
                
                // Adiciona os confrontos das semifinais
                chaveamento.sf.forEach((confronto, idx) => {
                    if (confronto) {
                        const match = criarElementoMatch(confronto, 'sf', idx);
                        centerColumn.insertBefore(match, finalContainer);
                    }
                });
            }
            
            // Atualiza a final e disputa pelo 3¬∫ lugar se existirem
            atualizarFinalETerceiroLugar();
            
            // Configura eventos de clique
            configurarEventosChaveamento();
            
            // Verifica se precisa mostrar o bot√£o de definir campe√£o
            verificarBotaoCampeao();
        }
        
        function getRoundTitle(colId) {
            switch(colId) {
                case 'round-32-left': return 'Rodada de 32';
                case 'round-32-right': return 'Rodada de 32';
                case 'round-16-left': return 'Oitavas de Final';
                case 'round-16-right': return 'Oitavas de Final';
                case 'round-center': return 'Finais';
                default: return 'Rodada';
            }
        }

        // Cria um elemento de confronto (match)
        function criarElementoMatch(confronto, rodada, indice) {
            const match = document.createElement('div');
            match.className = `match ${confronto.vencedor ? 'completed' : ''}`;
            match.setAttribute('data-rodada', rodada);
            match.setAttribute('data-indice', indice);
            
            const timeA = document.createElement('div');
            timeA.className = `team ${confronto.vencedor === confronto.a ? 'winner' : ''}`;
            timeA.setAttribute('data-time', confronto.a);
            timeA.innerHTML = `<span><span class="flag">${flags[confronto.a] || 'üè¥'}</span> <span class="name">${confronto.a}</span></span>`;
            
            const timeB = document.createElement('div');
            timeB.className = `team ${confronto.vencedor === confronto.b ? 'winner' : ''}`;
            timeB.setAttribute('data-time', confronto.b);
            timeB.innerHTML = `<span><span class="flag">${flags[confronto.b] || 'üè¥'}</span> <span class="name">${confronto.b}</span></span>`;
            
            match.appendChild(timeA);
            match.appendChild(timeB);
            
            return match;
        }

        // Atualiza a final e disputa pelo 3¬∫ lugar
        function atualizarFinalETerceiroLugar() {
            // Atualiza a final
            if (chaveamento.final) {
                const finalMatch = document.getElementById('final-match');
                const teams = finalMatch.querySelectorAll('.team');
                
                if (chaveamento.final.a) {
                    teams[0].innerHTML = `<span><span class="flag">${flags[chaveamento.final.a] || 'üè¥'}</span> <span class="name">${chaveamento.final.a}</span></span>`;
                    teams[0].className = `team ${chaveamento.final.vencedor === chaveamento.final.a ? 'winner' : ''}`;
                }
                
                if (chaveamento.final.b) {
                    teams[1].innerHTML = `<span><span class="flag">${flags[chaveamento.final.b] || 'üè¥'}</span> <span class="name">${chaveamento.final.b}</span></span>`;
                    teams[1].className = `team ${chaveamento.final.vencedor === chaveamento.final.b ? 'winner' : ''}`;
                }
            }
            
            // Atualiza a disputa pelo 3¬∫ lugar
            if (chaveamento.third) {
                document.getElementById('third-place-match').style.display = 'block';
                const terceiroMatch = document.getElementById('third-place-match');
                const teams = terceiroMatch.querySelectorAll('.team');
                
                teams[0].innerHTML = `<span><span class="flag">${flags[chaveamento.third.a] || 'üè¥'}</span> <span class="name">${chaveamento.third.a}</span></span>`;
                teams[0].className = `team ${chaveamento.third.vencedor === chaveamento.third.a ? 'winner' : ''}`;
                
                teams[1].innerHTML = `<span><span class="flag">${flags[chaveamento.third.b] || 'üè¥'}</span> <span class="name">${chaveamento.third.b}</span></span>`;
                teams[1].className = `team ${chaveamento.third.vencedor === chaveamento.third.b ? 'winner' : ''}`;
            }
        }

        // Configura eventos para o chaveamento
        function configurarEventosChaveamento() {
            // Evento de clique nos times dos confrontos
            document.addEventListener('click', function(e) {
                const teamElement = e.target.closest('.team');
                if (!teamElement) return;
                
                // Verifica se √© um time de um confronto (n√£o da final ou 3¬∫ lugar)
                const matchElement = teamElement.closest('.match');
                if (!matchElement) return;
                
                // Verifica se n√£o √© a final ou disputa de 3¬∫ lugar
                if (matchElement.id === 'final-match' || matchElement.id === 'third-place-match') {
                    return; // A final e 3¬∫ lugar s√£o tratados separadamente
                }
                
                const rodada = matchElement.getAttribute('data-rodada');
                const indice = parseInt(matchElement.getAttribute('data-indice'));
                const timeSelecionado = teamElement.getAttribute('data-time');
                
                // Verifica se estamos na fase correta
                if (rodada !== faseAtual) {
                    alert(`Voc√™ s√≥ pode selecionar vencedores na fase atual: ${getNomeFase(faseAtual)}`);
                    return;
                }
                
                if (rodada && !isNaN(indice) && timeSelecionado) {
                    // Define o vencedor
                    const confronto = chaveamento[rodada][indice];
                    if (confronto && (timeSelecionado === confronto.a || timeSelecionado === confronto.b)) {
                        confronto.vencedor = timeSelecionado;
                        
                        // Atualiza visualmente
                        atualizarConfrontoVisualmente(rodada, indice);
                        
                        // Atualiza controles e status
                        criarControlesFases();
                        atualizarStatus();
                    }
                }
            });
            
            // Evento para o bot√£o de definir campe√£o
            document.getElementById('btn-definir-campeao').addEventListener('click', function() {
                mostrarModalCampeao();
            });
            
            // Evento para a disputa de 3¬∫ lugar
            document.getElementById('third-place-match').addEventListener('click', function(e) {
                const teamElement = e.target.closest('.team');
                if (!teamElement || !chaveamento.third) return;
                
                const teamSide = teamElement.getAttribute('data-team');
                const timeVencedor = teamSide === 'third-1' ? chaveamento.third.a : chaveamento.third.b;
                
                chaveamento.third.vencedor = timeVencedor;
                
                // Atualiza visualmente
                const teams = this.querySelectorAll('.team');
                teams[0].className = `team ${chaveamento.third.vencedor === chaveamento.third.a ? 'winner' : ''}`;
                teams[1].className = `team ${chaveamento.third.vencedor === chaveamento.third.b ? 'winner' : ''}`;
            });
        }

        // Atualiza visualmente um confronto
        function atualizarConfrontoVisualmente(rodada, indice) {
            const confronto = chaveamento[rodada][indice];
            if (!confronto) return;
            
            // Encontra o elemento do confronto
            const selector = `.match[data-rodada="${rodada}"][data-indice="${indice}"]`;
            const matchElement = document.querySelector(selector);
            
            if (matchElement) {
                const teams = matchElement.querySelectorAll('.team');
                if (teams.length >= 2) {
                    // Atualiza o time A
                    teams[0].className = `team ${confronto.vencedor === confronto.a ? 'winner' : ''}`;
                    
                    // Atualiza o time B
                    teams[1].className = `team ${confronto.vencedor === confronto.b ? 'winner' : ''}`;
                    
                    // Marca o confronto como completado
                    matchElement.classList.add('completed');
                }
            }
        }

        // Verifica se deve mostrar o bot√£o para definir campe√£o
        function verificarBotaoCampeao() {
            if (chaveamento.final && chaveamento.final.a && chaveamento.final.b) {
                document.getElementById('btn-definir-campeao').style.display = 'block';
            } else {
                document.getElementById('btn-definir-campeao').style.display = 'none';
            }
        }

        // Mostra o modal para escolher o campe√£o
        function mostrarModalCampeao() {
            if (!chaveamento.final) return;
            
            const modal = document.getElementById('modal-campeao');
            const content = document.getElementById('campeao-content');
            
            content.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 20px; margin: 20px 0;">
                    <div class="team-option" data-campeao="${chaveamento.final.a}" style="padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.3s;">
                        <div style="font-size: 3rem;">${flags[chaveamento.final.a] || 'üè¥'}</div>
                        <h3 style="margin: 10px 0;">${chaveamento.final.a}</h3>
                        <p>Clique para escolher como campe√£o</p>
                    </div>
                    
                    <div style="text-align: center; font-size: 1.5rem; color: #666;">VS</div>
                    
                    <div class="team-option" data-campeao="${chaveamento.final.b}" style="padding: 20px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.3s;">
                        <div style="font-size: 3rem;">${flags[chaveamento.final.b] || 'üè¥'}</div>
                        <h3 style="margin: 10px 0;">${chaveamento.final.b}</h3>
                        <p>Clique para escolher como campe√£o</p>
                    </div>
                </div>
            `;
            
            // Configura eventos para as op√ß√µes
            const options = content.querySelectorAll('.team-option');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const campeao = this.getAttribute('data-campeao');
                    definirCampeao(campeao);
                });
                
                option.addEventListener('mouseenter', function() {
                    this.style.borderColor = '#3498db';
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = '0 10px 20px rgba(0,0,0,0.1)';
                });
                
                option.addEventListener('mouseleave', function() {
                    this.style.borderColor = '#ddd';
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
            
            modal.style.display = 'flex';
        }

        // Define o campe√£o
        function definirCampeao(campeao) {
            if (!chaveamento.final) return;
            
            chaveamento.final.vencedor = campeao;
            
            // Atualiza visualmente a final
            atualizarFinalETerceiroLugar();
            
            // Fecha o modal
            document.getElementById('modal-campeao').style.display = 'none';
            
            // Atualiza o status
            atualizarStatus();
            
            // Mostra mensagem de sucesso
            alert(`üèÜ ${campeao} √© o campe√£o da Copa do Mundo 2026!`);
        }

        // Atualiza a barra de status
        function atualizarStatus() {
            const statusGrupos = document.getElementById('status-grupos');
            const statusTextGrupos = document.getElementById('status-text-grupos');
            const statusMata = document.getElementById('status-mata');
            const statusTextMata = document.getElementById('status-text-mata');
            
            // Status da fase de grupos
            statusGrupos.className = 'status-icon active';
            statusTextGrupos.textContent = 'Pronta para montar chaveamento';
            
            // Status do mata-mata
            if (chaveamento.r32.length > 0) {
                statusMata.className = 'status-icon active';
                
                if (chaveamento.final && chaveamento.final.vencedor) {
                    statusTextMata.textContent = 'Finalizada! Campe√£o definido';
                } else if (chaveamento.final && chaveamento.final.a && chaveamento.final.b) {
                    statusTextMata.textContent = 'Final pronta para decis√£o';
                } else {
                    statusTextMata.textContent = `${getNomeFase(faseAtual)} em andamento`;
                }
            } else {
                statusMata.className = 'status-icon waiting';
                statusTextMata.textContent = 'Aguardando montagem do chaveamento';
            }
        }

        // Configura os eventos dos bot√µes
        function configurarEventos() {
            // Bot√£o para montar chaveamento
            document.getElementById('btn-montar-chaveamento').addEventListener('click', montarChaveamento);
            
            // Bot√£o para redefinir grupos (voltar √† ordem original)
            document.getElementById('btn-reset-grupos').addEventListener('click', function() {
                grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
                renderizarGrupos();
                atualizarStatus();
            });
            
            // Bot√£o para nova simula√ß√£o completa
            document.getElementById('btn-nova-simulacao').addEventListener('click', function() {
                grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
                chaveamento = { r32: [], r16: [], qf: [], sf: [], final: null, third: null };
                faseAtual = 'r32';
                renderizarGrupos();
                document.getElementById('section-mata-mata').style.display = 'none';
                atualizarStatus();
                
                // Restaura texto do bot√£o
                document.getElementById('btn-montar-chaveamento').innerHTML = '<i class="fas fa-sitemap"></i> Montar Chaveamento';
            });
            
            // Fechar modal
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('modal-campeao').style.display = 'none';
            });
            
            // Fechar modal clicando fora
            document.getElementById('modal-campeao').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
