<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Oficial - Copa do Mundo 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a2980;
            --secondary: #26d0ce;
            --accent: #ff4757;
            --success: #2ed573;
            --warning: #ffa502;
            --light: #f1f2f6;
            --dark: #2f3542;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* HEADER */
        header {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius);
            padding: 30px 40px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            text-align: center;
            border-bottom: 5px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        h1 {
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        h1 i {
            color: var(--accent);
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .tournament-info {
            background: linear-gradient(135deg, #e3f2fd, #e8f5e9);
            border-radius: var(--radius);
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
            text-align: left;
        }
        
        .tournament-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tournament-info ul {
            padding-left: 20px;
            line-height: 1.6;
        }
        
        .tournament-info li {
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        .btn {
            padding: 15px 32px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #1e90ff);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 144, 255, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #1dd1a1);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 213, 115, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--accent), #ff3838);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 71, 87, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff7f00);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 165, 2, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* SE√á√ÉO DOS GRUPOS */
        .groups-section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
        }
        
        .groups-section h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8rem;
        }
        
        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .group-card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border-top: 5px solid var(--secondary);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .group-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }
        
        .group-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .group-card h3 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.6rem;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .team-list {
            list-style: none;
            min-height: 280px;
        }
        
        .team-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: grab;
            transition: var(--transition);
            border-left: 5px solid transparent;
            position: relative;
            user-select: none;
        }
        
        .team-item:active {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .team-item.primeiro {
            border-left-color: #00b894;
            background: linear-gradient(90deg, #f0fff4, #ffffff);
        }
        
        .team-item.segundo {
            border-left-color: #0984e3;
            background: linear-gradient(90deg, #f0f8ff, #ffffff);
        }
        
        .team-item.terceiro {
            border-left-color: #fdcb6e;
            background: linear-gradient(90deg, #fffaf0, #ffffff);
        }
        
        .team-item.quarto {
            border-left-color: #636e72;
            background: linear-gradient(90deg, #f8f9fa, #ffffff);
        }
        
        .team-pos {
            background: var(--primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            flex-shrink: 0;
        }
        
        .team-flag {
            font-size: 1.8rem;
            flex-shrink: 0;
        }
        
        .team-name {
            flex-grow: 1;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .drag-info {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            border-radius: 50px;
            padding: 10px 25px;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* MODAL DE SELE√á√ÉO DOS TERCEIROS */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .modal h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
            font-size: 2rem;
        }
        
        .modal-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .selection-instruction {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
            border-left: 4px solid var(--secondary);
        }
        
        .selection-instruction i {
            color: var(--secondary);
            margin-right: 10px;
        }
        
        .terceiros-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .terceiro-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .terceiro-item:hover {
            background: #e9ecef;
            transform: translateY(-3px);
        }
        
        .terceiro-item.selected {
            background: #e8f5e9;
            border-color: var(--success);
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.2);
        }
        
        .terceiro-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition);
        }
        
        .terceiro-item.selected .terceiro-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .terceiro-item.selected .terceiro-checkbox::after {
            content: "‚úì";
            font-weight: bold;
        }
        
        .terceiro-info {
            flex-grow: 1;
        }
        
        .terceiro-group {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .counter-display {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 25px;
            padding: 10px;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .counter-display span {
            font-weight: bold;
            color: var(--primary);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--accent);
        }
        
        /* CONTROLE DE FASES */
        .phase-control-above {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: none;
        }
        
        .phase-control-above.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .phase-control-above h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .phase-control-above p {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .phase-control-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .btn-phase {
            padding: 18px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--success), #1dd1a1);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(46, 213, 115, 0.3);
        }
        
        .btn-phase:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 30px rgba(46, 213, 115, 0.4);
        }
        
        .btn-back {
            padding: 18px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--warning), #ff7f00);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(255, 165, 2, 0.3);
        }
        
        .btn-back:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 30px rgba(255, 165, 2, 0.4);
        }
        
        /* SE√á√ÉO DO CHAVEAMENTO */
        .bracket-section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            display: none;
        }
        
        .bracket-section h2 {
            color: var(--primary);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8rem;
            text-align: center;
        }
        
        .bracket-container {
            position: relative;
            min-height: 800px;
            overflow-x: auto;
            padding: 20px 0;
            -webkit-overflow-scrolling: touch;
        }
        
        .bracket {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            min-width: 1600px;
            margin: 0 auto;
        }
        
        .round-column {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            flex: 1;
            min-height: 850px;
            padding: 0 10px;
        }
        
        .round-column.left {
            align-items: flex-start;
        }
        
        .round-column.right {
            align-items: flex-end;
        }
        
        .round-column.center {
            align-items: center;
            flex: 0.6;
        }
        
        .round-title {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--light), #ffffff);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            width: fit-content;
            align-self: center;
        }
        
        .match {
            background: white;
            border-radius: 10px;
            padding: 0;
            margin: 12px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
            transition: var(--transition);
            width: 240px;
            position: relative;
            overflow: hidden;
        }
        
        .match:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .match::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }
        
        .team {
            padding: 16px 18px;
            margin: 0;
            border-bottom: 1px solid #f1f2f6;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            position: relative;
        }
        
        .team:last-child {
            border-bottom: none;
        }
        
        .team:hover {
            background: #f8f9fa;
        }
        
        .team.winner {
            background: linear-gradient(90deg, #e8f5e9, #ffffff);
            font-weight: 700;
            color: #00b894;
        }
        
        .team.winner::after {
            content: "‚úì";
            color: #00b894;
            font-weight: bold;
            font-size: 1.2rem;
            margin-left: 10px;
        }
        
        .team .flag {
            font-size: 1.4rem;
            margin-right: 12px;
        }
        
        .team .name {
            flex-grow: 1;
            font-size: 1rem;
        }
        
        .final-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        .final-match {
            width: 280px;
            border: 2px solid var(--accent);
            box-shadow: 0 10px 30px rgba(255, 71, 87, 0.15);
        }
        
        .final-match::before {
            content: "üèÜ FINAL";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent), #ff3838);
            color: white;
            padding: 6px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
        }
        
        .third-place {
            width: 260px;
            border: 2px solid #fdcb6e;
        }
        
        .third-place::before {
            content: "ü•â 3¬∫ LUGAR";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 6px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
        }
        
        /* BOT√ÉO DE VOLTAR FASE FIXO */
        .back-phase-fixed {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            display: none;
        }
        
        .back-phase-fixed.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* STATUS BAR */
        .status-bar {
            background: white;
            border-radius: var(--radius);
            padding: 20px 30px;
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .status-icon.active {
            background: var(--success);
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.7);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 213, 115, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 213, 115, 0); }
        }
        
        .status-icon.waiting {
            background: #fdcb6e;
        }
        
        .status-text {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        /* FOOTER */
        footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* RESPONSIVIDADE */
        @media (max-width: 1600px) {
            .bracket {
                min-width: 1400px;
            }
        }
        
        @media (max-width: 1400px) {
            .bracket {
                min-width: 1200px;
            }
            
            .match {
                width: 200px;
            }
        }
        
        @media (max-width: 1200px) {
            .bracket {
                min-width: 1000px;
            }
            
            .match {
                width: 180px;
            }
            
            .team {
                padding: 14px 16px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
                padding: 12px 24px;
            }
            
            .groups-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .team-item {
                padding: 12px;
                gap: 10px;
            }
            
            .modal {
                padding: 20px;
                max-height: 85vh;
            }
            
            .terceiros-container {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .bracket {
                min-width: 900px;
            }
            
            .round-column {
                min-height: 700px;
            }
            
            .match {
                width: 160px;
            }
            
            .team {
                padding: 12px 14px;
            }
            
            .team .name {
                font-size: 0.9rem;
            }
            
            .final-match {
                width: 220px;
            }
            
            .third-place {
                width: 200px;
            }
            
            .phase-control-buttons {
                flex-direction: column;
            }
            
            .btn-phase, .btn-back {
                width: 100%;
                justify-content: center;
                padding: 15px 30px;
                font-size: 1.1rem;
            }
            
            .back-phase-fixed {
                position: static;
                margin-top: 20px;
                text-align: center;
                width: 100%;
            }
            
            .back-phase-fixed.active {
                display: flex;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-futbol"></i> Simulador Oficial - Copa do Mundo 2026</h1>
            <p class="subtitle">Novo formato: 48 sele√ß√µes, 12 grupos, fase de 16-avos</p>
            
            <div class="tournament-info">
                <h3><i class="fas fa-info-circle"></i> Como funciona a Copa 2026:</h3>
                <ul>
                    <li><strong>48 sele√ß√µes</strong> divididas em <strong>12 grupos de 4 times</strong></li>
                    <li>Classificam os <strong>2 primeiros de cada grupo (24 times)</strong> + <strong>8 melhores terceiros</strong></li>
                    <li><strong>32 times</strong> avan√ßam para o mata-mata</li>
                    <li><strong>Nova fase:</strong> 16-avos de final (Round of 32)</li>
                    <li>Campe√£o joga <strong>8 partidas</strong> (antes eram 7)</li>
                </ul>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" id="btn-montar-chaveamento">
                    <i class="fas fa-sitemap"></i> Montar Chaveamento (32 times)
                </button>
                <button class="btn btn-success" id="btn-reset-grupos">
                    <i class="fas fa-redo"></i> Redefinir Grupos
                </button>
                <button class="btn btn-danger" id="btn-nova-simulacao">
                    <i class="fas fa-fire"></i> Nova Simula√ß√£o
                </button>
            </div>
        </header>
        
        <section class="groups-section">
            <h2><i class="fas fa-list-ol"></i> Fase de Grupos (12 Grupos)</h2>
            <p class="drag-info"><i class="fas fa-arrows-alt"></i> Arraste os times para definir a classifica√ß√£o (1¬∫ a 4¬∫ lugar)</p>
            
            <div class="groups-container" id="grupos-container">
                <!-- Grupos ser√£o gerados aqui -->
            </div>
        </section>
        
        <!-- MODAL DE SELE√á√ÉO DOS TERCEIROS COLOCADOS -->
        <div class="modal-overlay" id="modal-terceiros">
            <div class="modal">
                <button class="close-modal" id="close-modal">&times;</button>
                
                <h2><i class="fas fa-users"></i> Selecionar Terceiros Colocados</h2>
                <p class="modal-subtitle">Escolha os 8 terceiros colocados que avan√ßar√£o para os 16-avos de final</p>
                
                <div class="selection-instruction">
                    <i class="fas fa-info-circle"></i>
                    <strong>Instru√ß√£o:</strong> Clique em 8 sele√ß√µes abaixo para completar as 32 vagas do mata-mata
                </div>
                
                <div class="counter-display">
                    Selecionados: <span id="contador-selecionados">0</span> de 8 terceiros colocados
                </div>
                
                <div class="terceiros-container" id="terceiros-container">
                    <!-- Lista de terceiros colocados ser√° gerada aqui -->
                </div>
                
                <div class="modal-buttons">
                    <button class="btn btn-success" id="btn-confirmar-terceiros" disabled>
                        <i class="fas fa-check"></i> Confirmar Sele√ß√£o (8 times)
                    </button>
                    <button class="btn btn-warning" id="btn-cancelar-selecao">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
        
        <!-- CONTROLE DE FASES (ACIMA DO CHAVEAMENTO) -->
        <div class="phase-control-above" id="phase-control-above">
            <!-- Conte√∫do ser√° inserido dinamicamente -->
        </div>
        
        <section class="bracket-section" id="bracket-section">
            <h2><i class="fas fa-trophy"></i> Chaveamento - Fase Final (32 times)</h2>
            
            <div class="bracket-container">
                <div class="bracket" id="chaveamento-container">
                    <!-- Coluna dos 16-avos (Esquerda) -->
                    <div class="round-column left" id="round-32-left">
                        <div class="round-title">16-avos - Esquerda</div>
                    </div>
                    
                    <!-- Coluna das Oitavas (Esquerda) -->
                    <div class="round-column left" id="round-16-left">
                        <div class="round-title">Oitavas - Esquerda</div>
                    </div>
                    
                    <!-- Coluna das Quartas (Esquerda) -->
                    <div class="round-column left" id="quarters-left">
                        <div class="round-title">Quartas - Esquerda</div>
                    </div>
                    
                    <!-- Coluna das Semifinais (Esquerda) -->
                    <div class="round-column left" id="semis-left">
                        <div class="round-title">Semifinais - Esquerda</div>
                    </div>
                    
                    <!-- Coluna Central (Final e 3¬∫ Lugar) -->
                    <div class="round-column center" id="round-center">
                        <div class="final-container">
                            <div class="match final-match" id="final-match">
                                <div class="team" data-team="final-1">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                                <div class="team" data-team="final-2">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                            </div>
                            
                            <div class="match third-place" id="third-place-match">
                                <div class="team" data-team="third-1">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                                <div class="team" data-team="third-2">
                                    <span><span class="flag">üè¥</span> <span class="name">A definir</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Coluna das Semifinais (Direita) -->
                    <div class="round-column right" id="semis-right">
                        <div class="round-title">Semifinais - Direita</div>
                    </div>
                    
                    <!-- Coluna das Quartas (Direita) -->
                    <div class="round-column right" id="quarters-right">
                        <div class="round-title">Quartas - Direita</div>
                    </div>
                    
                    <!-- Coluna das Oitavas (Direita) -->
                    <div class="round-column right" id="round-16-right">
                        <div class="round-title">Oitavas - Direita</div>
                    </div>
                    
                    <!-- Coluna dos 16-avos (Direita) -->
                    <div class="round-column right" id="round-32-right">
                        <div class="round-title">16-avos - Direita</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- BOT√ÉO FIXO PARA VOLTAR FASE -->
        <div class="back-phase-fixed" id="back-phase-fixed">
            <button class="btn btn-warning" id="btn-voltar-fase-fixo">
                <i class="fas fa-undo"></i> Voltar Fase
            </button>
        </div>
        
        <div class="status-bar">
            <div class="status">
                <div class="status-icon waiting" id="status-grupos"></div>
                <span class="status-text">Fase de Grupos: <strong id="status-text-grupos">Aguardando defini√ß√£o</strong></span>
            </div>
            <div class="status">
                <div class="status-icon waiting" id="status-mata"></div>
                <span class="status-text">Fase Mata-Mata: <strong id="status-text-mata">N√£o iniciada</strong></span>
            </div>
            <div class="status">
                <div class="status-icon waiting" id="status-fase"></div>
                <span class="status-text">Fase Atual: <strong id="status-text-fase">-</strong></span>
            </div>
        </div>
        
        <footer>
            <p>Simulador do Novo Formato da Copa do Mundo 2026 | 48 sele√ß√µes, 12 grupos, fase de 16-avos</p>
            <p>Dados baseados no sorteio oficial de 5 de dezembro de 2025 | As 6 vagas de repescagem s√£o representadas</p>
        </footer>
    </div>

    <script>
        // DADOS DOS 12 GRUPOS - FORMATO COPA 2026
        const gruposData = [
            { letra: 'A', times: ['M√©xico', '√Åfrica do Sul', 'Coreia do Sul', 'Rep√∫blica Tcheca'] },
            { letra: 'B', times: ['Canad√°', 'It√°lia', 'Catar', 'Su√≠√ßa'] },
            { letra: 'C', times: ['Brasil', 'Marrocos', 'Haiti', 'Esc√≥cia'] },
            { letra: 'D', times: ['Estados Unidos', 'Paraguai', 'Austr√°lia', 'Turquia'] },
            { letra: 'E', times: ['Alemanha', 'Cura√ßao', 'Costa do Marfim', 'Equador'] },
            { letra: 'F', times: ['Holanda', 'Jap√£o', 'Ucr√¢nia', 'Tun√≠sia'] },
            { letra: 'G', times: ['B√©lgica', 'Egito', 'Ir√£', 'Nova Zel√¢ndia'] },
            { letra: 'H', times: ['Espanha', 'Cabo Verde', 'Ar√°bia Saudita', 'Uruguai'] },
            { letra: 'I', times: ['Fran√ßa', 'Senegal', 'Bol√≠via', 'Noruega'] },
            { letra: 'J', times: ['Argentina', 'Arg√©lia', '√Åustria', 'Jord√¢nia'] },
            { letra: 'K', times: ['Portugal', 'RD Congo', 'Uzbequist√£o', 'Col√¥mbia'] },
            { letra: 'L', times: ['Inglaterra', 'Cro√°cia', 'Gana', 'Panam√°'] }
        ];

        // Bandeiras para os times
        const flags = {
            'Brasil': 'üáßüá∑', 'Argentina': 'üá¶üá∑', 'Fran√ßa': 'üá´üá∑', 'Alemanha': 'üá©üá™',
            'Espanha': 'üá™üá∏', 'Inglaterra': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', 'Portugal': 'üáµüáπ', 'B√©lgica': 'üáßüá™',
            'Holanda': 'üá≥üá±', 'It√°lia': 'üáÆüáπ', 'Cro√°cia': 'üá≠üá∑', 'Uruguai': 'üá∫üáæ',
            'M√©xico': 'üá≤üáΩ', 'Estados Unidos': 'üá∫üá∏', 'Canad√°': 'üá®üá¶', 'Jap√£o': 'üáØüáµ',
            'Coreia do Sul': 'üá∞üá∑', 'Austr√°lia': 'üá¶üá∫', 'Marrocos': 'üá≤üá¶', 'Senegal': 'üá∏üá≥',
            'Egito': 'üá™üá¨', 'Gana': 'üá¨üá≠', 'Catar': 'üá∂üá¶', 'Ar√°bia Saudita': 'üá∏üá¶',
            'Ir√£': 'üáÆüá∑', 'Col√¥mbia': 'üá®üá¥', 'Paraguai': 'üáµüáæ', 'Chile': 'üá®üá±',
            'Equador': 'üá™üá®', 'Peru': 'üáµüá™', 'Su√≠√ßa': 'üá®üá≠', 'Su√©cia': 'üá∏üá™',
            'Pol√¥nia': 'üáµüá±', '√Åustria': 'üá¶üáπ', 'Ucr√¢nia': 'üá∫üá¶', 'Turquia': 'üáπüá∑',
            'Rep√∫blica Tcheca': 'üá®üáø', 'Esc√≥cia': 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', 'Noruega': 'üá≥üá¥', 'Costa do Marfim': 'üá®üáÆ',
            'Tun√≠sia': 'üáπüá≥', 'Arg√©lia': 'üá©üáø', 'Nig√©ria': 'üá≥üá¨', 'Cabo Verde': 'üá®üáª',
            'Haiti': 'üá≠üáπ', 'Panam√°': 'üáµüá¶', 'Bol√≠via': 'üáßüá¥', 'RD Congo': 'üá®üá©',
            'Nova Zel√¢ndia': 'üá≥üáø', 'Jord√¢nia': 'üáØüá¥', 'Uzbequist√£o': 'üá∫üáø', 'Cura√ßao': 'üá®üáº',
            '√Åfrica do Sul': 'üáøüá¶'
        };

        // Estado da simula√ß√£o
        let grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
        let classificados = { 
            primeiros: [],   // 12 times (1¬∫ de cada grupo)
            segundos: [],    // 12 times (2¬∫ de cada grupo)
            terceiros: []    // 8 melhores terceiros (SELECIONADOS PELO USU√ÅRIO)
        };
        
        let todosTerceirosDisponiveis = []; // Todos os 12 terceiros colocados (BASEADO NA ORDEM ATUAL)
        let terceirosSelecionados = [];     // Os 8 selecionados pelo usu√°rio
        
        let chaveamento = { 
            r32: [],    // 16 jogos (32 times)
            r16: [],    // 8 jogos (16 times)
            qf: [],     // 4 jogos (8 times)
            sf: [],     // 2 jogos (4 times)
            final: [],  // 1 jogo (2 times)
            terceiro: [] // 1 jogo (2 times)
        };
        
        let faseAtual = '32avos';
        let todasFasesCompletas = false;
        let historicoFases = [];
        let itemArrastando = null;

        // Inicializa a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            renderizarGrupos();
            configurarEventos();
            atualizarStatus();
        });

        // Renderiza os 12 grupos com drag-and-drop
        function renderizarGrupos() {
            const container = document.getElementById('grupos-container');
            container.innerHTML = '';
            
            grupoOrdenado.forEach(grupo => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                groupCard.innerHTML = `
                    <h3>Grupo ${grupo.letra}</h3>
                    <ul class="team-list" data-grupo="${grupo.letra}" id="grupo-${grupo.letra}">
                        ${grupo.times.map((time, index) => `
                            <li class="team-item ${index === 0 ? 'primeiro' : index === 1 ? 'segundo' : index === 2 ? 'terceiro' : 'quarto'}" 
                                data-time="${time}" draggable="true">
                                <div class="team-pos">${index + 1}</div>
                                <div class="team-flag">${flags[time] || 'üè¥'}</div>
                                <div class="team-name">${time}</div>
                                <i class="fas fa-arrows-alt-v" style="color: #aaa;"></i>
                            </li>
                        `).join('')}
                    </ul>
                `;
                
                container.appendChild(groupCard);
            });
            
            configurarDragAndDrop();
        }

        // Configura√ß√£o do drag-and-drop
        function configurarDragAndDrop() {
            const lists = document.querySelectorAll('.team-list');
            
            lists.forEach(list => {
                list.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(list, e.clientY);
                    const draggable = document.querySelector('.team-item.dragging');
                    
                    if (draggable && list.dataset.grupo === draggable.closest('.team-list').dataset.grupo) {
                        if (afterElement == null) {
                            list.appendChild(draggable);
                        } else {
                            list.insertBefore(draggable, afterElement);
                        }
                    }
                });
                
                list.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                });
                
                list.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (itemArrastando) {
                        const afterElement = getDragAfterElement(list, e.clientY);
                        if (afterElement == null) {
                            list.appendChild(itemArrastando);
                        } else {
                            list.insertBefore(itemArrastando, afterElement);
                        }
                        atualizarOrdemGrupo(list.dataset.grupo);
                        atualizarStatus();
                    }
                });
            });
            
            document.querySelectorAll('.team-item').forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    itemArrastando = e.target;
                    e.target.classList.add('dragging');
                    setTimeout(() => {
                        e.target.style.opacity = '0.4';
                    }, 0);
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                    e.target.style.opacity = '';
                    itemArrastando = null;
                    const grupoLetra = e.target.closest('.team-list').dataset.grupo;
                    atualizarOrdemGrupo(grupoLetra);
                });
            });
        }

        // Fun√ß√£o auxiliar para determinar onde soltar o elemento
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.team-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Atualiza a ordem dos times no grupo
        function atualizarOrdemGrupo(grupoLetra) {
            const grupoIndex = grupoOrdenado.findIndex(g => g.letra === grupoLetra);
            const list = document.querySelector(`[data-grupo="${grupoLetra}"]`);
            
            if (!list) return;
            
            const novosTimes = Array.from(list.children).map(item => item.dataset.time);
            grupoOrdenado[grupoIndex].times = novosTimes;
            
            Array.from(list.children).forEach((item, index) => {
                item.className = 'team-item';
                if (index === 0) item.classList.add('primeiro');
                else if (index === 1) item.classList.add('segundo');
                else if (index === 2) item.classList.add('terceiro');
                else item.classList.add('quarto');
                
                const posElement = item.querySelector('.team-pos');
                if (posElement) {
                    posElement.textContent = index + 1;
                }
            });
        }

        // Calcula os classificados (primeiros e segundos) BASEADO NA ORDEM ATUAL DO USU√ÅRIO
        function calcularPrimeirosESegundos() {
            classificados = { primeiros: [], segundos: [], terceiros: [] };
            todosTerceirosDisponiveis = [];
            
            // CORRE√á√ÉO: Usa a ordem atual definida pelo usu√°rio (grupoOrdenado)
            // N√£o simula resultados, usa a posi√ß√£o atual na interface
            grupoOrdenado.forEach(grupo => {
                const times = grupo.times; // J√° est√° na ordem definida pelo usu√°rio
                
                // Adiciona os classificados baseado na posi√ß√£o atual (0 = 1¬∫, 1 = 2¬∫, 2 = 3¬∫)
                classificados.primeiros.push({ 
                    grupo: grupo.letra, 
                    time: times[0]
                });
                
                classificados.segundos.push({ 
                    grupo: grupo.letra, 
                    time: times[1]
                });
                
                // Adiciona terceiro √† lista dispon√≠vel
                todosTerceirosDisponiveis.push({
                    grupo: grupo.letra,
                    time: times[2]
                });
            });
            
            return classificados;
        }

        // Abre o modal para sele√ß√£o dos terceiros
        function abrirModalSelecaoTerceiros() {
            // Calcula primeiros e segundos BASEADO NA ORDEM ATUAL
            calcularPrimeirosESegundos();
            
            // Limpa sele√ß√µes anteriores
            terceirosSelecionados = [];
            
            // Renderiza a lista de terceiros dispon√≠veis (BASEADO NA ORDEM ATUAL)
            const container = document.getElementById('terceiros-container');
            container.innerHTML = '';
            
            todosTerceirosDisponiveis.forEach((terceiro, index) => {
                const item = document.createElement('div');
                item.className = 'terceiro-item';
                item.dataset.index = index;
                item.innerHTML = `
                    <div class="terceiro-checkbox"></div>
                    <div class="terceiro-info">
                        <div class="team-flag" style="font-size: 1.5rem; display: inline-block; margin-right: 10px;">
                            ${flags[terceiro.time] || 'üè¥'}
                        </div>
                        <strong>${terceiro.time}</strong>
                        <div class="terceiro-group">Grupo ${terceiro.grupo}</div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    toggleSelecaoTerceiro(index, item);
                });
                
                container.appendChild(item);
            });
            
            // Atualiza contador
            atualizarContadorSelecao();
            
            // Mostra o modal
            document.getElementById('modal-terceiros').classList.add('active');
        }

        // Alterna sele√ß√£o de um terceiro
        function toggleSelecaoTerceiro(index, elemento) {
            const terceiro = todosTerceirosDisponiveis[index];
            
            // Verifica se j√° est√° selecionado
            const jaSelecionado = terceirosSelecionados.some(t => t.time === terceiro.time);
            
            if (jaSelecionado) {
                // Remove da sele√ß√£o
                terceirosSelecionados = terceirosSelecionados.filter(t => t.time !== terceiro.time);
                elemento.classList.remove('selected');
            } else {
                // Verifica se j√° selecionou 8
                if (terceirosSelecionados.length >= 8) {
                    alert('Voc√™ j√° selecionou 8 terceiros colocados. Desmarque um para selecionar outro.');
                    return;
                }
                
                // Adiciona √† sele√ß√£o
                terceirosSelecionados.push(terceiro);
                elemento.classList.add('selected');
            }
            
            // Atualiza contador e habilita/desabilita bot√£o
            atualizarContadorSelecao();
        }

        // Atualiza o contador de sele√ß√£o
        function atualizarContadorSelecao() {
            const contador = document.getElementById('contador-selecionados');
            const btnConfirmar = document.getElementById('btn-confirmar-terceiros');
            
            contador.textContent = terceirosSelecionados.length;
            
            // Habilita bot√£o se tiver 8 selecionados
            if (terceirosSelecionados.length === 8) {
                btnConfirmar.disabled = false;
                btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Confirmar Sele√ß√£o (8 times)';
            } else {
                btnConfirmar.disabled = true;
                btnConfirmar.innerHTML = `<i class="fas fa-check"></i> Selecione mais ${8 - terceirosSelecionados.length}`;
            }
        }

        // Confirma a sele√ß√£o dos terceiros e monta o chaveamento
        function confirmarSelecaoTerceiros() {
            if (terceirosSelecionados.length !== 8) {
                alert('Por favor, selecione exatamente 8 terceiros colocados.');
                return;
            }
            
            // Atualiza os classificados com os terceiros selecionados
            classificados.terceiros = terceirosSelecionados;
            
            // Fecha o modal
            document.getElementById('modal-terceiros').classList.remove('active');
            
            // Monta o chaveamento
            montarChaveamentoAposSelecao();
        }

        // Monta o chaveamento ap√≥s sele√ß√£o dos terceiros
        function montarChaveamentoAposSelecao() {
            // Limpa chaveamentos anteriores
            chaveamento = { 
                r32: [], r16: [], qf: [], sf: [], final: [], terceiro: []
            };
            
            historicoFases = [];
            
            // CHAVEAMENTO OFICIAL DA COPA 2026 (SIMPLIFICADO)
            // Primeiros colocados vs Terceiros selecionados (8 confrontos)
            for (let i = 0; i < 8; i++) {
                if (classificados.primeiros[i] && classificados.terceiros[i]) {
                    chaveamento.r32.push({
                        a: classificados.primeiros[i].time,
                        b: classificados.terceiros[i].time,
                        vencedor: null
                    });
                }
            }
            
            // Restantes dos primeiros + Segundos colocados (8 confrontos)
            for (let i = 8; i < 12; i++) {
                if (classificados.primeiros[i] && classificados.segundos[i-8]) {
                    chaveamento.r32.push({
                        a: classificados.primeiros[i].time,
                        b: classificados.segundos[i-8].time,
                        vencedor: null
                    });
                }
            }
            
            // Cruzamento entre segundos colocados restantes
            for (let i = 4; i < 12; i++) {
                if (classificados.segundos[i]) {
                    const oponenteIndex = (i + 4) % 8 + 4;
                    const oponente = classificados.segundos[oponenteIndex] || classificados.segundos[4];
                    
                    if (oponente && classificados.segundos[i].time !== oponente.time) {
                        chaveamento.r32.push({
                            a: classificados.segundos[i].time,
                            b: oponente.time,
                            vencedor: null
                        });
                    }
                }
            }
            
            // Garantir que temos exatamente 16 confrontos
            chaveamento.r32 = chaveamento.r32.slice(0, 16);
            
            // Salva estado inicial
            salvarEstadoFase();
            
            // Mostra se√ß√£o do chaveamento
            document.getElementById('bracket-section').style.display = 'block';
            
            // Renderiza o chaveamento
            renderizarChaveamento();
            
            // Atualiza status
            faseAtual = '32avos';
            todasFasesCompletas = false;
            atualizarStatus();
            verificarFaseCompleta();
            atualizarBotaoVoltarFase();
            
            // Scroll para o chaveamento
            document.getElementById('bracket-section').scrollIntoView({ behavior: 'smooth' });
        }

        // SALVA ESTADO NO HIST√ìRICO
        function salvarEstadoFase() {
            historicoFases.push({
                fase: faseAtual,
                chaveamento: JSON.parse(JSON.stringify(chaveamento)),
                classificados: JSON.parse(JSON.stringify(classificados)),
                terceirosSelecionados: [...terceirosSelecionados]
            });
            
            if (historicoFases.length > 10) {
                historicoFases.shift();
            }
        }

        // VOLTA FASE ANTERIOR
        function voltarFaseAnterior() {
            if (historicoFases.length === 0) return;
            
            const estadoAnterior = historicoFases.pop();
            
            chaveamento = JSON.parse(JSON.stringify(estadoAnterior.chaveamento));
            faseAtual = estadoAnterior.fase;
            classificados = JSON.parse(JSON.stringify(estadoAnterior.classificados));
            
            if (estadoAnterior.terceirosSelecionados) {
                terceirosSelecionados = [...estadoAnterior.terceirosSelecionados];
            }
            
            renderizarChaveamento();
            atualizarStatus();
            verificarFaseCompleta();
            atualizarBotaoVoltarFase();
        }

        // RENDERIZA O CHAVEAMENTO COMPLETO
        function renderizarChaveamento() {
            const idsColunas = [
                'round-32-left', 'round-32-right',
                'round-16-left', 'round-16-right',
                'quarters-left', 'quarters-right',
                'semis-left', 'semis-right'
            ];
            
            idsColunas.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    const title = container.querySelector('.round-title');
                    container.innerHTML = '';
                    if (title) container.appendChild(title);
                }
            });
            
            // Renderiza 16-avos
            const round32Left = document.getElementById('round-32-left');
            const round32Right = document.getElementById('round-32-right');
            
            chaveamento.r32.slice(0, 8).forEach((conf, idx) => {
                const match = criarElementoConfronto('r32', idx, conf);
                round32Left.appendChild(match);
            });
            
            chaveamento.r32.slice(8, 16).forEach((conf, idx) => {
                const match = criarElementoConfronto('r32', idx + 8, conf);
                round32Right.appendChild(match);
            });
            
            // Renderiza Oitavas
            const round16Left = document.getElementById('round-16-left');
            const round16Right = document.getElementById('round-16-right');
            
            chaveamento.r16.slice(0, 4).forEach((conf, idx) => {
                const match = criarElementoConfronto('r16', idx, conf);
                round16Left.appendChild(match);
            });
            
            chaveamento.r16.slice(4, 8).forEach((conf, idx) => {
                const match = criarElementoConfronto('r16', idx + 4, conf);
                round16Right.appendChild(match);
            });
            
            // Renderiza Quartas
            const quartersLeft = document.getElementById('quarters-left');
            const quartersRight = document.getElementById('quarters-right');
            
            chaveamento.qf.slice(0, 2).forEach((conf, idx) => {
                const match = criarElementoConfronto('qf', idx, conf);
                quartersLeft.appendChild(match);
            });
            
            chaveamento.qf.slice(2, 4).forEach((conf, idx) => {
                const match = criarElementoConfronto('qf', idx + 2, conf);
                quartersRight.appendChild(match);
            });
            
            // Renderiza Semifinais
            const semisLeft = document.getElementById('semis-left');
            chaveamento.sf.forEach((conf, idx) => {
                if (idx < 2) {
                    const match = criarElementoConfronto('sf', idx, conf);
                    semisLeft.appendChild(match);
                }
            });
            
            // Renderiza Final
            const finalMatch = document.getElementById('final-match');
            if (chaveamento.final.length > 0) {
                const conf = chaveamento.final[0];
                finalMatch.innerHTML = `
                    <div class="team ${conf.vencedor === conf.a ? 'winner' : ''}" data-match="final-0" data-team="a">
                        <span><span class="flag">${flags[conf.a] || 'üè¥'}</span> <span class="name">${conf.a}</span></span>
                    </div>
                    <div class="team ${conf.vencedor === conf.b ? 'winner' : ''}" data-match="final-0" data-team="b">
                        <span><span class="flag">${flags[conf.b] || 'üè¥'}</span> <span class="name">${conf.b}</span></span>
                    </div>
                `;
            }
            
            // Renderiza 3¬∫ Lugar
            const thirdPlaceMatch = document.getElementById('third-place-match');
            if (chaveamento.terceiro.length > 0) {
                const conf = chaveamento.terceiro[0];
                thirdPlaceMatch.innerHTML = `
                    <div class="team ${conf.vencedor === conf.a ? 'winner' : ''}" data-match="terceiro-0" data-team="a">
                        <span><span class="flag">${flags[conf.a] || 'üè¥'}</span> <span class="name">${conf.a}</span></span>
                    </div>
                    <div class="team ${conf.vencedor === conf.b ? 'winner' : ''}" data-match="terceiro-0" data-team="b">
                        <span><span class="flag">${flags[conf.b] || 'üè¥'}</span> <span class="name">${conf.b}</span></span>
                    </div>
                `;
            }
            
            configurarEventosChaveamento();
        }

        // CRIA ELEMENTO DE CONFRONTO
        function criarElementoConfronto(fase, idx, conf) {
            const match = document.createElement('div');
            match.className = 'match';
            match.innerHTML = `
                <div class="team ${conf.vencedor === conf.a ? 'winner' : ''}" data-match="${fase}-${idx}" data-team="a">
                    <span><span class="flag">${flags[conf.a] || 'üè¥'}</span> <span class="name">${conf.a}</span></span>
                </div>
                <div class="team ${conf.vencedor === conf.b ? 'winner' : ''}" data-match="${fase}-${idx}" data-team="b">
                    <span><span class="flag">${flags[conf.b] || 'üè¥'}</span> <span class="name">${conf.b}</span></span>
                </div>
            `;
            return match;
        }

        // CONFIGURA EVENTOS DO CHAVEAMENTO
        function configurarEventosChaveamento() {
            document.querySelectorAll('.team').forEach(team => {
                team.addEventListener('click', function() {
                    if (todasFasesCompletas) return;
                    
                    const matchData = this.dataset.match;
                    const teamSide = this.dataset.team;
                    
                    if (!matchData) return;
                    
                    const [fase, index] = matchData.split('-');
                    const matchIdx = parseInt(index);
                    
                    salvarEstadoFase();
                    
                    let confronto;
                    switch(fase) {
                        case 'r32': confronto = chaveamento.r32[matchIdx]; break;
                        case 'r16': confronto = chaveamento.r16[matchIdx]; break;
                        case 'qf': confronto = chaveamento.qf[matchIdx]; break;
                        case 'sf': confronto = chaveamento.sf[matchIdx]; break;
                        case 'final': confronto = chaveamento.final[matchIdx]; break;
                        case 'terceiro': confronto = chaveamento.terceiro[matchIdx]; break;
                    }
                    
                    if (confronto) {
                        confronto.vencedor = teamSide === 'a' ? confronto.a : confronto.b;
                        
                        if (fase === 'r32') {
                            chaveamento.r16 = [];
                            chaveamento.qf = [];
                            chaveamento.sf = [];
                            chaveamento.final = [];
                            chaveamento.terceiro = [];
                            faseAtual = '32avos';
                        } else if (fase === 'r16') {
                            chaveamento.qf = [];
                            chaveamento.sf = [];
                            chaveamento.final = [];
                            chaveamento.terceiro = [];
                            faseAtual = '16avos';
                        } else if (fase === 'qf') {
                            chaveamento.sf = [];
                            chaveamento.final = [];
                            chaveamento.terceiro = [];
                            faseAtual = 'quartas';
                        } else if (fase === 'sf') {
                            chaveamento.final = [];
                            chaveamento.terceiro = [];
                            faseAtual = 'semifinal';
                        }
                        
                        renderizarChaveamento();
                        atualizarStatus();
                        verificarFaseCompleta();
                        atualizarBotaoVoltarFase();
                    }
                });
            });
        }

        // VERIFICA SE FASE EST√Å COMPLETA
        function verificarFaseCompleta() {
            const control = document.getElementById('phase-control-above');
            
            let faseCompleta = false;
            let proximaFase = '';
            let textoFase = '';
            
            switch(faseAtual) {
                case '32avos':
                    faseCompleta = chaveamento.r32.every(c => c.vencedor);
                    proximaFase = '16avos';
                    textoFase = '16-avos de Final';
                    break;
                case '16avos':
                    faseCompleta = chaveamento.r16.every(c => c.vencedor);
                    proximaFase = 'quartas';
                    textoFase = 'Oitavas de Final';
                    break;
                case 'quartas':
                    faseCompleta = chaveamento.qf.every(c => c.vencedor);
                    proximaFase = 'semifinal';
                    textoFase = 'Quartas de Final';
                    break;
                case 'semifinal':
                    faseCompleta = chaveamento.sf.every(c => c.vencedor);
                    proximaFase = 'final';
                    textoFase = 'Semifinais';
                    break;
                case 'final':
                    faseCompleta = chaveamento.final.length > 0 && chaveamento.final[0].vencedor;
                    proximaFase = 'completo';
                    textoFase = 'Final';
                    break;
            }
            
            if (faseCompleta && proximaFase !== 'completo') {
                control.innerHTML = `
                    <h3>${textoFase} Conclu√≠da!</h3>
                    <p>Todos os confrontos da ${textoFase.toLowerCase()} foram definidos.</p>
                    <div class="phase-control-buttons">
                        <button class="btn-phase" id="btn-avancar-fase">
                            <i class="fas fa-arrow-right"></i> Avan√ßar para ${proximaFase === '16avos' ? 'Oitavas' : proximaFase === 'quartas' ? 'Quartas' : proximaFase === 'semifinal' ? 'Semifinais' : 'Final'}
                        </button>
                        ${faseAtual !== '32avos' ? `<button class="btn-back" id="btn-voltar-fase">
                            <i class="fas fa-undo"></i> Voltar para ${faseAtual === '16avos' ? '16-avos' : faseAtual === 'quartas' ? 'Oitavas' : faseAtual === 'semifinal' ? 'Quartas' : 'Semifinais'}
                        </button>` : ''}
                    </div>
                `;
                control.classList.add('active');
                
                document.getElementById('btn-avancar-fase').addEventListener('click', () => {
                    salvarEstadoFase();
                    avancarParaProximaFase(proximaFase);
                });
                
                const btnVoltar = document.getElementById('btn-voltar-fase');
                if (btnVoltar) {
                    btnVoltar.addEventListener('click', voltarFaseAnterior);
                }
            } else if (proximaFase === 'completo' && faseCompleta) {
                control.innerHTML = `
                    <h3>üèÜ Copa do Mundo 2026 Conclu√≠da!</h3>
                    <p>O campe√£o √© <strong>${chaveamento.final[0].vencedor}</strong>!</p>
                    <div class="phase-control-buttons">
                        <button class="btn-phase" id="btn-nova-simulacao2">
                            <i class="fas fa-redo"></i> Iniciar Nova Simula√ß√£o
                        </button>
                        <button class="btn-back" id="btn-voltar-final">
                            <i class="fas fa-undo"></i> Voltar para Semifinais
                        </button>
                    </div>
                `;
                control.classList.add('active');
                todasFasesCompletas = true;
                
                document.getElementById('btn-nova-simulacao2').addEventListener('click', novaSimulacao);
                document.getElementById('btn-voltar-final').addEventListener('click', voltarFaseAnterior);
            } else {
                control.classList.remove('active');
            }
        }

        // AVAN√áA PARA PR√ìXIMA FASE
        function avancarParaProximaFase(proximaFase) {
            switch(faseAtual) {
                case '32avos':
                    for (let i = 0; i < 16; i += 2) {
                        if (chaveamento.r32[i] && chaveamento.r32[i+1]) {
                            chaveamento.r16.push({
                                a: chaveamento.r32[i].vencedor,
                                b: chaveamento.r32[i+1].vencedor,
                                vencedor: null
                            });
                        }
                    }
                    faseAtual = '16avos';
                    break;
                    
                case '16avos':
                    for (let i = 0; i < 8; i += 2) {
                        if (chaveamento.r16[i] && chaveamento.r16[i+1]) {
                            chaveamento.qf.push({
                                a: chaveamento.r16[i].vencedor,
                                b: chaveamento.r16[i+1].vencedor,
                                vencedor: null
                            });
                        }
                    }
                    faseAtual = 'quartas';
                    break;
                    
                case 'quartas':
                    for (let i = 0; i < 4; i += 2) {
                        if (chaveamento.qf[i] && chaveamento.qf[i+1]) {
                            chaveamento.sf.push({
                                a: chaveamento.qf[i].vencedor,
                                b: chaveamento.qf[i+1].vencedor,
                                vencedor: null
                            });
                        }
                    }
                    faseAtual = 'semifinal';
                    break;
                    
                case 'semifinal':
                    if (chaveamento.sf[0] && chaveamento.sf[1]) {
                        chaveamento.final = [{
                            a: chaveamento.sf[0].vencedor,
                            b: chaveamento.sf[1].vencedor,
                            vencedor: null
                        }];
                        
                        chaveamento.terceiro = [{
                            a: chaveamento.sf[0].vencedor === chaveamento.final[0].a ? 
                               chaveamento.sf[0].b : chaveamento.sf[0].a,
                            b: chaveamento.sf[1].vencedor === chaveamento.final[0].b ?
                               chaveamento.sf[1].b : chaveamento.sf[1].a,
                            vencedor: null
                        }];
                    }
                    faseAtual = 'final';
                    break;
            }
            
            renderizarChaveamento();
            atualizarStatus();
            verificarFaseCompleta();
            atualizarBotaoVoltarFase();
            document.getElementById('phase-control-above').classList.remove('active');
        }

        // ATUALIZA BOT√ÉO VOLTAR FASE
        function atualizarBotaoVoltarFase() {
            const backButton = document.getElementById('back-phase-fixed');
            backButton.classList.toggle('active', faseAtual !== '32avos' && historicoFases.length > 0);
        }

        // ATUALIZA BARRA DE STATUS
        function atualizarStatus() {
            const statusGrupos = document.getElementById('status-grupos');
            const statusTextGrupos = document.getElementById('status-text-grupos');
            const statusMata = document.getElementById('status-mata');
            const statusTextMata = document.getElementById('status-text-mata');
            const statusFase = document.getElementById('status-fase');
            const statusTextFase = document.getElementById('status-text-fase');
            
            statusGrupos.className = 'status-icon active';
            statusTextGrupos.textContent = 'Definida pelo usu√°rio';
            
            if (chaveamento.r32.length > 0) {
                statusMata.className = 'status-icon active';
                
                let faseTexto = '';
                switch(faseAtual) {
                    case '32avos': faseTexto = '16-avos de Final'; break;
                    case '16avos': faseTexto = 'Oitavas de Final'; break;
                    case 'quartas': faseTexto = 'Quartas de Final'; break;
                    case 'semifinal': faseTexto = 'Semifinais'; break;
                    case 'final': faseTexto = 'Final'; break;
                }
                
                statusTextMata.textContent = `Em andamento (${faseTexto})`;
                statusTextFase.textContent = faseTexto;
                statusFase.className = 'status-icon active';
            } else {
                statusMata.className = 'status-icon waiting';
                statusTextMata.textContent = 'Aguardando montagem';
                statusTextFase.textContent = '-';
                statusFase.className = 'status-icon waiting';
            }
        }

        // NOVA SIMULA√á√ÉO
        function novaSimulacao() {
            grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
            classificados = { primeiros: [], segundos: [], terceiros: [] };
            todosTerceirosDisponiveis = [];
            terceirosSelecionados = [];
            chaveamento = { r32: [], r16: [], qf: [], sf: [], final: [], terceiro: [] };
            faseAtual = '32avos';
            todasFasesCompletas = false;
            historicoFases = [];
            
            renderizarGrupos();
            renderizarChaveamento();
            atualizarStatus();
            
            document.getElementById('bracket-section').style.display = 'none';
            document.getElementById('phase-control-above').classList.remove('active');
            document.getElementById('back-phase-fixed').classList.remove('active');
            
            document.getElementById('btn-montar-chaveamento').innerHTML = '<i class="fas fa-sitemap"></i> Montar Chaveamento (32 times)';
        }

        // CONFIGURA EVENTOS DOS BOT√ïES
        function configurarEventos() {
            // Bot√£o para abrir modal de sele√ß√£o
            document.getElementById('btn-montar-chaveamento').addEventListener('click', abrirModalSelecaoTerceiros);
            
            // Bot√£o para redefinir grupos
            document.getElementById('btn-reset-grupos').addEventListener('click', () => {
                grupoOrdenado = JSON.parse(JSON.stringify(gruposData));
                renderizarGrupos();
                atualizarStatus();
            });
            
            // Bot√£o para nova simula√ß√£o
            document.getElementById('btn-nova-simulacao').addEventListener('click', novaSimulacao);
            
            // Bot√£o fixo para voltar fase
            document.getElementById('btn-voltar-fase-fixo').addEventListener('click', voltarFaseAnterior);
            
            // Bot√µes do modal
            document.getElementById('btn-confirmar-terceiros').addEventListener('click', confirmarSelecaoTerceiros);
            document.getElementById('btn-cancelar-selecao').addEventListener('click', () => {
                document.getElementById('modal-terceiros').classList.remove('active');
            });
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('modal-terceiros').classList.remove('active');
            });
            
            // Fechar modal clicando fora
            document.getElementById('modal-terceiros').addEventListener('click', (e) => {
                if (e.target === document.getElementById('modal-terceiros')) {
                    document.getElementById('modal-terceiros').classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>